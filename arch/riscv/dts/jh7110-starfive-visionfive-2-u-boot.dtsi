// SPDX-License-Identifier: GPL-2.0 OR MIT
/*
 * Copyright (C) 2023 StarFive Technology Co., Ltd.
 */

#include "binman.dtsi"
#include "jh7110-u-boot.dtsi"
/ {
	chosen {
		bootph-pre-ram;
		opensbi-domains {
			compatible = "opensbi,domain,config";

			tmem: tmem {
				compatible = "opensbi,domain,memregion";
				base = <0x0 0x41000000>;
				order = <24>; // 16MiB
			};

			allmem: allmem {
				compatible = "opensbi,domain,memregion";
				base = <0x0 0x0>;
				order = <64>;
			};

			tdomain: trusted-domain {
				compatible = "opensbi,domain,instance";
				regions = <&allmem 0x3f>;
				possible-harts = <&U74_1 &U74_2 &U74_3 &U74_4>;
				boot-hart = <&U74_1>;
				next-addr = <0x0 0x41000000>; /* optee_os: CFG_TDDRAM_START
							       * u-boot  : CONFIG_SPL_OPTEE_IMAGE_LOAD_ADDR
							       */
				next-mode = <0x1>;
			};

			udomain: untrusted-domain {
				compatible = "opensbi,domain,instance";
				regions = <&tmem 0x0>, <&allmem 0x3f>;
				possible-harts = <&U74_1 &U74_2 &U74_3 &U74_4>;
				boot-hart = <&U74_1>;
				next-addr = <0x0 0x40200000>; /* u-boot: CONFIG_TEXT_BASE */
				next-mode = <0x1>;
			};
		};
	};

	sbi-mpxy-opteed {
		opensbi-domain-instance = <&tdomain>;
		riscv,sbi-mpxy-channel-id = <0x2>;
		compatible = "riscv,sbi-mpxy-opteed";
	};

	firmware {
		spi0 = &qspi;
		bootph-pre-ram;
	};

	config {
		bootph-pre-ram;
		u-boot,spl-payload-offset = <0x100000>;
	};

	memory@40000000 {
		bootph-pre-ram;
	};
};

&U74_1 {
	opensbi-domain = <&tdomain>;
};

&U74_2 {
	opensbi-domain = <&tdomain>;
};

&U74_3 {
	opensbi-domain = <&tdomain>;
};

&U74_4 {
	opensbi-domain = <&tdomain>;
};

&uart0 {
	bootph-pre-ram;
};

&mmc0 {
	bootph-pre-ram;
};

&mmc1 {
	bootph-pre-ram;
};

&qspi {
	bootph-pre-ram;

	nor-flash@0 {
		bootph-pre-ram;
	};
};

&sysgpio {
	bootph-pre-ram;
};

&mmc0_pins {
	bootph-pre-ram;
	mmc0-pins-rest {
		bootph-pre-ram;
	};
};

&mmc1_pins {
	bootph-pre-ram;
	mmc1-pins0 {
		bootph-pre-ram;
	};

	mmc1-pins1 {
		bootph-pre-ram;
	};
};

&i2c5_pins {
	bootph-pre-ram;
	i2c-pins {
		bootph-pre-ram;
	};
};

&i2c5 {
	bootph-pre-ram;
	eeprom@50 {
		bootph-pre-ram;
	};
};

&binman {
	itb {
		fit {
			images {
				fdt-1 {
					description = "NAME";
					load = <0x40400000>;
					compression = "none";

					uboot_fdt_blob: blob-ext {
						filename = "u-boot.dtb";
					};
				};
			};

			configurations {
				conf-1 {
					fdt = "fdt-1";
				};
			};
		};
	};

	spl-img {
		filename = "spl/u-boot-spl.bin.normal.out";

		mkimage {
			args = "-T sfspl";

			u-boot-spl {
			};
		};
	};
};
